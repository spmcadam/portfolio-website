<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rocket Simulation Demo</title>

  <!-- PyScript CSS/JS from the official CDN -->
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
  <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    .param-row {
      margin-bottom: 1em;
    }
    button {
      margin-top: 1em;
      padding: 0.5em 1em;
    }
    #plot-container {
      margin-top: 2em;
    }
  </style>
</head>
<body>

<h1>Client-Side Rocket Launch Simulation</h1>
<p>
  Enter parameters, then click "Run Simulation" to see the three vertical subplots:
  <ul>
    <li>Altitude vs Time</li>
    <li>Velocity Components vs Time</li>
    <li>Total Velocity vs Time</li>
  </ul>
</p>

<!-- 1) PyScript environment: specify needed packages. -->
<script type="py-env">
packages = [
  "numpy",
  "pandas",
  "matplotlib"
]
</script>

<!-- 2) Load your rocket.py code but keep it hidden from view. -->
<py-script src="rocket.py" hidden></py-script>

<!-- 3) Simple form for parameters. -->
<div class="param-row">
  <label>Vertical velocity before pitch (m/s): 
    <input type="number" id="vert_v0" value="25" step="1" />
  </label>
</div>
<div class="param-row">
  <label>Final pitch stage1 (deg):
    <input type="number" id="final_pitch_stage1" value="70" step="1" />
  </label>
</div>
<div class="param-row">
  <label>Final pitch stage2 (deg):
    <input type="number" id="final_pitch_stage2" value="90" step="1" />
  </label>
</div>
<div class="param-row">
  <label>% burntime stage2 (0.65 default):
    <input type="number" id="perc_burntime2" value="0.65" step="0.01" />
  </label>
</div>
<div class="param-row">
  <label>Coast time (s):
    <input type="number" id="coast_time" value="60" step="1" />
  </label>
</div>

<button id="run-btn" onclick="runSimulation()" disabled>Run Simulation</button>

<div id="loading-indicator" style="display:none; font-weight:bold; margin-top: 1em;">
  ðŸš€ Running simulation, please wait...
</div>
<!-- 4) Container where the plot image will be inserted -->
<div id="plot-container">
  <!-- Will display an <img> tag here after running simulation -->
</div>

<script>
document.addEventListener("pyscript:ready", () => {
  document.getElementById("run-btn").disabled = false;
  console.log("PyScript initialized successfully.");
});

document.addEventListener("pyscript:error", (e) => {
  console.error("PyScript initialization failed:", e.detail);
});
  // Enable the Run button once PyScript has fully loaded
document.addEventListener("pyscript:ready", () => {
  document.getElementById("run-btn").disabled = false;
  console.log("PyScript is ready.");
});

async function runSimulation() {
  const loadingEl = document.getElementById("loading-indicator");
  const plotEl = document.getElementById("plot-container");

  loadingEl.style.display = "block";
  plotEl.innerHTML = "";

  const v0    = document.getElementById("vert_v0").value;
  const p1    = document.getElementById("final_pitch_stage1").value;
  const p2    = document.getElementById("final_pitch_stage2").value;
  const burn  = document.getElementById("perc_burntime2").value;
  const coast = document.getElementById("coast_time").value;

  const command = `from pyscript import Element
  result = run_simulation('${v0}', '${p1}', '${p2}', '${burn}', '${coast}')
  Element("plot-container").write(result)`;

  try {
    await pyscript.interpreter.run(command);
  } catch (err) {
    console.error("Simulation failed:", err);
    plotEl.innerHTML = "<p style='color:red;'>Simulation failed. See console for details.</p>";
  } finally {
    loadingEl.style.display = "none";
  }
}
</script>

</body>
</html>

