<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rocket Simulation Demo</title>

  <!-- Load Pyodide from the recommended CDN -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.27.4/full/pyodide.js"></script>

  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    .param-row {
      margin-bottom: 1em;
    }
    button {
      margin-top: 1em;
      padding: 0.5em 1em;
    }
    #plot-container {
      margin-top: 2em;
    }
  </style>
</head>
<body>

<!-- Banner -->
<h1>Starship Launch Simulation</h1>
<p>Enter parameters, then click "Run Simulation" to see the three vertical subplots:</p>
<ul>
  <li>Altitude vs Time</li>
  <li>Velocity Components vs Time</li>
  <li>Total Velocity vs Time</li>
</ul>

<!-- Simple form for parameters -->
<div class="param-row">
  <label>Vertical velocity before pitch (m/s):
    <input type="number" id="vert_v0" value="25" step="1" />
  </label>
</div>
<div class="param-row">
  <label>% burntime stage2 (0.65 default):
    <input type="number" id="perc_burntime2" value="0.65" step="0.01" />
  </label>
</div>
<div class="param-row">
  <label>Coast time (s):
    <input type="number" id="coast_time" value="60" step="1" />
  </label>
</div>

<button onclick="runSimulation()">Run Simulation</button>

<!-- Container where the plot image will be inserted -->
<div id="plot-container">
  <!-- The generated <img> tag will be inserted here -->
</div>

<script>
// Initialize Pyodide, load required packages, and then load rocket.py into the global namespace
async function initPyodide() {
  // Load Pyodide and assign the instance globally
  window.pyodideInstance = await loadPyodide();
  
  // Load the required packages
  await window.pyodideInstance.loadPackage(["numpy", "pandas", "matplotlib"]);
  
  // Fetch rocket.py from your server and run its code so that its definitions become global
  let rocketCode = await (await fetch("rocket.py")).text();
  window.pyodideInstance.runPython(rocketCode);
}
initPyodide();

// Function to run the simulation when the button is clicked
async function runSimulation() {
  // Read parameter values from the form
  const v0    = document.getElementById("vert_v0").value;
  const burn  = document.getElementById("perc_burntime2").value;
  const coast = document.getElementById("coast_time").value;

  // Build a multi-line Python command string that calls run_simulation
  // and then sets the innerHTML of the element with id "plot-container"
  const command = `
from __main__ import run_simulation  
result = run_simulation('${v0}', '${burn}', '${coast}')
import js
js.document.getElementById("plot-container").innerHTML = result
`;

  // Execute the Python code asynchronously using the loaded Pyodide instance
  await window.pyodideInstance.runPythonAsync(command);
}
</script>

</body>
</html>




